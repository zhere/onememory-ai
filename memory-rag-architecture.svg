<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="900" viewBox="0 0 1200 900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- 渐变定义 -->
    <linearGradient id="memoryGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4F46E5;stop-opacity:0.8" />
      <stop offset="100%" style="stop-color:#7C3AED;stop-opacity:0.8" />
    </linearGradient>
    
    <linearGradient id="ragGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#059669;stop-opacity:0.8" />
      <stop offset="100%" style="stop-color:#0891B2;stop-opacity:0.8" />
    </linearGradient>
    
    <linearGradient id="fusionGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#DC2626;stop-opacity:0.8" />
      <stop offset="100%" style="stop-color:#EA580C;stop-opacity:0.8" />
    </linearGradient>
    
    <linearGradient id="llmGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#7C2D12;stop-opacity:0.8" />
      <stop offset="100%" style="stop-color:#92400E;stop-opacity:0.8" />
    </linearGradient>
    
    <!-- 阴影效果 -->
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="4" stdDeviation="3" flood-color="#000000" flood-opacity="0.15"/>
    </filter>
    
    <!-- 箭头标记 -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
            refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#374151"/>
    </marker>
  </defs>
  
  <!-- 背景 -->
  <rect width="1200" height="900" fill="#F9FAFB"/>
  
  <!-- 标题 -->
  <text x="600" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#1F2937">
    Supermemory + RAG 技术架构图
  </text>
  
  <!-- 用户界面层 -->
  <g id="user-interface">
    <rect x="50" y="80" width="1100" height="60" rx="8" fill="#E5E7EB" stroke="#9CA3AF" stroke-width="2"/>
    <text x="600" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#374151">
      用户界面层 (Frontend Layer)
    </text>
    
    <!-- UI组件 -->
    <rect x="80" y="160" width="120" height="40" rx="6" fill="#F3F4F6" stroke="#6B7280" stroke-width="1"/>
    <text x="140" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#374151">Web应用</text>
    
    <rect x="230" y="160" width="120" height="40" rx="6" fill="#F3F4F6" stroke="#6B7280" stroke-width="1"/>
    <text x="290" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#374151">移动端</text>
    
    <rect x="380" y="160" width="120" height="40" rx="6" fill="#F3F4F6" stroke="#6B7280" stroke-width="1"/>
    <text x="440" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#374151">API客户端</text>
  </g>
  
  <!-- API网关层 -->
  <g id="api-gateway">
    <rect x="50" y="240" width="1100" height="60" rx="8" fill="#DBEAFE" stroke="#3B82F6" stroke-width="2"/>
    <text x="600" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#1E40AF">
      API网关层 (API Gateway Layer)
    </text>
    
    <!-- API组件 -->
    <rect x="80" y="320" width="100" height="35" rx="5" fill="#EFF6FF" stroke="#3B82F6" stroke-width="1"/>
    <text x="130" y="342" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#1E40AF">认证服务</text>
    
    <rect x="200" y="320" width="100" height="35" rx="5" fill="#EFF6FF" stroke="#3B82F6" stroke-width="1"/>
    <text x="250" y="342" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#1E40AF">限流控制</text>
    
    <rect x="320" y="320" width="100" height="35" rx="5" fill="#EFF6FF" stroke="#3B82F6" stroke-width="1"/>
    <text x="370" y="342" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#1E40AF">路由分发</text>
  </g>
  
  <!-- 核心服务层 -->
  <g id="core-services">
    <rect x="50" y="400" width="1100" height="200" rx="8" fill="#FEF3C7" stroke="#F59E0B" stroke-width="2"/>
    <text x="600" y="430" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#92400E">
      核心服务层 (Core Services Layer)
    </text>
    
    <!-- 记忆管理服务 -->
    <g id="memory-service">
      <rect x="70" y="460" width="200" height="120" rx="8" fill="url(#memoryGradient)" filter="url(#shadow)"/>
      <text x="170" y="485" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
        记忆管理服务
      </text>
      
      <rect x="85" y="500" width="170" height="25" rx="4" fill="white" fill-opacity="0.9"/>
      <text x="170" y="517" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#4F46E5">MemoryManager</text>
      
      <rect x="85" y="530" width="170" height="25" rx="4" fill="white" fill-opacity="0.9"/>
      <text x="170" y="547" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#4F46E5">ContextOptimizer</text>
      
      <rect x="85" y="560" width="170" height="25" rx="4" fill="white" fill-opacity="0.9"/>
      <text x="170" y="577" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#4F46E5">PrioritySorter</text>
    </g>
    
    <!-- RAG知识管理服务 -->
    <g id="rag-service">
      <rect x="300" y="460" width="200" height="120" rx="8" fill="url(#ragGradient)" filter="url(#shadow)"/>
      <text x="400" y="485" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
        RAG知识管理服务
      </text>
      
      <rect x="315" y="500" width="170" height="25" rx="4" fill="white" fill-opacity="0.9"/>
      <text x="400" y="517" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#059669">RAGKnowledgeManager</text>
      
      <rect x="315" y="530" width="170" height="25" rx="4" fill="white" fill-opacity="0.9"/>
      <text x="400" y="547" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#059669">EmbeddingService</text>
      
      <rect x="315" y="560" width="170" height="25" rx="4" fill="white" fill-opacity="0.9"/>
      <text x="400" y="577" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#059669">VectorDatabase</text>
    </g>
    
    <!-- 融合服务 -->
    <g id="fusion-service">
      <rect x="530" y="460" width="200" height="120" rx="8" fill="url(#fusionGradient)" filter="url(#shadow)"/>
      <text x="630" y="485" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
        融合服务层
      </text>
      
      <rect x="545" y="500" width="170" height="25" rx="4" fill="white" fill-opacity="0.9"/>
      <text x="630" y="517" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#DC2626">EnhancedChatService</text>
      
      <rect x="545" y="530" width="170" height="25" rx="4" fill="white" fill-opacity="0.9"/>
      <text x="630" y="547" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#DC2626">TokenCounter</text>
      
      <rect x="545" y="560" width="170" height="25" rx="4" fill="white" fill-opacity="0.9"/>
      <text x="630" y="577" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#DC2626">LLMAdapter</text>
    </g>
    
    <!-- 时序知识图谱 -->
    <g id="zep-service">
      <rect x="760" y="460" width="200" height="120" rx="8" fill="#DDD6FE" stroke="#8B5CF6" stroke-width="2" filter="url(#shadow)"/>
      <text x="860" y="485" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#5B21B6">
        时序知识图谱
      </text>
      
      <rect x="775" y="500" width="170" height="25" rx="4" fill="white" fill-opacity="0.9"/>
      <text x="860" y="517" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#7C3AED">ZepGraphitiManager</text>
      
      <rect x="775" y="530" width="170" height="25" rx="4" fill="white" fill-opacity="0.9"/>
      <text x="860" y="547" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#7C3AED">TemporalEntities</text>
      
      <rect x="775" y="560" width="170" height="25" rx="4" fill="white" fill-opacity="0.9"/>
      <text x="860" y="577" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#7C3AED">RelationInference</text>
    </g>
  </g>
  
  <!-- 数据存储层 -->
  <g id="data-layer">
    <rect x="50" y="630" width="1100" height="200" rx="8" fill="#E0E7FF" stroke="#6366F1" stroke-width="2"/>
    <text x="600" y="660" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#4338CA">
      数据存储层 (Data Storage Layer)
    </text>
    
    <!-- 向量数据库 -->
    <g id="vector-db">
      <rect x="70" y="690" width="150" height="80" rx="6" fill="#C7D2FE" stroke="#4F46E5" stroke-width="1"/>
      <text x="145" y="715" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#312E81">
        向量数据库
      </text>
      <text x="145" y="735" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#3730A3">Pinecone</text>
      <text x="145" y="750" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#3730A3">pgvector</text>
    </g>
    
    <!-- 关系数据库 -->
    <g id="relational-db">
      <rect x="250" y="690" width="150" height="80" rx="6" fill="#C7D2FE" stroke="#4F46E5" stroke-width="1"/>
      <text x="325" y="715" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#312E81">
        关系数据库
      </text>
      <text x="325" y="735" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#3730A3">PostgreSQL</text>
      <text x="325" y="750" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#3730A3">MySQL</text>
    </g>
    
    <!-- 缓存层 -->
    <g id="cache">
      <rect x="430" y="690" width="150" height="80" rx="6" fill="#C7D2FE" stroke="#4F46E5" stroke-width="1"/>
      <text x="505" y="715" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#312E81">
        缓存层
      </text>
      <text x="505" y="735" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#3730A3">Redis</text>
      <text x="505" y="750" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#3730A3">Memcached</text>
    </g>
    
    <!-- 对象存储 -->
    <g id="object-storage">
      <rect x="610" y="690" width="150" height="80" rx="6" fill="#C7D2FE" stroke="#4F46E5" stroke-width="1"/>
      <text x="685" y="715" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#312E81">
        对象存储
      </text>
      <text x="685" y="735" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#3730A3">AWS S3</text>
      <text x="685" y="750" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#3730A3">MinIO</text>
    </g>
    
    <!-- 知识图谱存储 -->
    <g id="graph-storage">
      <rect x="790" y="690" width="150" height="80" rx="6" fill="#C7D2FE" stroke="#4F46E5" stroke-width="1"/>
      <text x="865" y="715" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#312E81">
        图数据库
      </text>
      <text x="865" y="735" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#3730A3">Neo4j</text>
      <text x="865" y="750" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#3730A3">JanusGraph</text>
    </g>
    
    <!-- 外部知识源 -->
    <g id="external-sources">
      <rect x="970" y="690" width="150" height="80" rx="6" fill="#C7D2FE" stroke="#4F46E5" stroke-width="1"/>
      <text x="1045" y="715" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#312E81">
        外部知识源
      </text>
      <text x="1045" y="735" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#3730A3">Elasticsearch</text>
      <text x="1045" y="750" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#3730A3">API接口</text>
    </g>
  </g>
  
  <!-- 连接线 -->
  <!-- 用户界面到API网关 -->
  <line x1="600" y1="200" x2="600" y2="240" stroke="#6B7280" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- API网关到核心服务 -->
  <line x1="600" y1="360" x2="600" y2="400" stroke="#6B7280" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 核心服务到数据层 -->
  <line x1="600" y1="600" x2="600" y2="630" stroke="#6B7280" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 内部服务连接 -->
  <line x1="170" y1="580" x2="170" y2="690" stroke="#6B7280" stroke-width="1" marker-end="url(#arrowhead)"/>
  <line x1="400" y1="580" x2="400" y2="690" stroke="#6B7280" stroke-width="1" marker-end="url(#arrowhead)"/>
  <line x1="630" y1="580" x2="505" y2="690" stroke="#6B7280" stroke-width="1" marker-end="url(#arrowhead)"/>
  <line x1="860" y1="580" x2="865" y2="690" stroke="#6B7280" stroke-width="1" marker-end="url(#arrowhead)"/>
  
  <!-- 融合服务与其他服务的连接 -->
  <line x1="630" y1="500" x2="270" y2="500" stroke="#DC2626" stroke-width="1" stroke-dasharray="3,3"/>
  <line x1="630" y1="520" x2="500" y2="520" stroke="#DC2626" stroke-width="1" stroke-dasharray="3,3"/>
  
  <!-- 图例 -->
  <g id="legend" transform="translate(50, 850)">
    <text x="0" y="0" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#374151">图例:</text>
    
    <rect x="60" y="-10" width="15" height="10" rx="2" fill="url(#memoryGradient)"/>
    <text x="80" y="-1" font-family="Arial, sans-serif" font-size="10" fill="#374151">记忆功能</text>
    
    <rect x="150" y="-10" width="15" height="10" rx="2" fill="url(#ragGradient)"/>
    <text x="170" y="-1" font-family="Arial, sans-serif" font-size="10" fill="#374151">RAG功能</text>
    
    <rect x="230" y="-10" width="15" height="10" rx="2" fill="url(#fusionGradient)"/>
    <text x="250" y="-1" font-family="Arial, sans-serif" font-size="10" fill="#374151">融合层</text>
    
    <line x1="320" y1="-5" x2="340" y2="-5" stroke="#6B7280" stroke-width="1" marker-end="url(#arrowhead)"/>
    <text x="345" y="-1" font-family="Arial, sans-serif" font-size="10" fill="#374151">数据流</text>
    
    <line x1="420" y1="-5" x2="440" y2="-5" stroke="#DC2626" stroke-width="1" stroke-dasharray="2,2"/>
    <text x="445" y="-1" font-family="Arial, sans-serif" font-size="10" fill="#374151">服务调用</text>
  </g>
</svg>